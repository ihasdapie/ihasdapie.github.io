<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta lang="en">

    <title>Engsci Y2S1 Exam Review | chenbrian</title>

    <style>*{box-sizing:border-box}body{margin:40px auto;max-width:800px;line-height:1.6;font-size:16px;color:#444;font-family:sans-serif;padding:0 10px}h1,h2,h3{line-height:1.2;font-family:sans-serif;color:#444}div.header h1{padding-top:0;padding-bottom:8px;margin-bottom:24px;font-size:16px;font-weight:400;border-bottom:1px solid}.header-menu{float:right}ul.pagination{list-style-type:none;text-align:center;padding:0}ul.pagination>li{padding:0 8px;display:inline-block}div.footer{border-top:1px solid;text-align:center}img{max-width:100%;max-height:100%;display:block;margin-left:auto;margin-right:auto}button{border:none;background:0 0;border-radius:5px}button:hover{background:#f1f1f1}table{border-collapse:collapse;width:100%}td,th{border:1px solid #444;padding:.5rem;text-align:left}@media only screen and (max-width:1450px){#back_to_top{visibility:visible!important}#toc{display:none}}.katex-display>.katex{overflow:auto hidden}.katex .katex-html>.newline{display:block;padding-bottom:.25em;padding-top:.25em}#toc{position:fixed;top:40px;right:0;padding-right:80px;line-height:1.4em;max-width:400px;margin:auto}#back_to_top{position:fixed;top:10px;right:10px;width:100px;visibility:hidden}blockquote{background:#f1f1f1;border-left:4px solid #ccc;padding-left:8px}code:not([class*=language-]){border-radius:.25rem;padding:.1rem;background-color:#f1f1f1}p+ul,p+ol,ul+ol,ol+ul{margin-top:-10px}ul,ol,li{padding-left:.5 em}a.footnote-ref::before{content:'['}a.footnote-ref::after{content:']'} 
            body {
                margin-left: 250px;   
            }
            @media only screen and (max-width: 1450px) {
                body {
                    margin: 40px auto;
                }
            }

        





    </style>



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>


    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B0ZFV4LTG2"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-B0ZFV4LTG2', { 'anonymize_ip': false });
}
</script>


    

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#33b884">
<meta name="msapplication-TileColor" content="#33b884">
<meta name="theme-color" content="#33b884">



</head>

<body>
<div class="header">
    <h1>
        <a href="//chenbrian.ca">chenbrian</a>
        <div class="header-menu">
            <a href="/about/">about</a> &nbsp;
            <a href="/posts/">blog</a> &nbsp;
            <a href="/tags/">tags</a> &nbsp;
        </div>
    </h1>
</div>

<div id="content">
        
            <aside id="back_to_top">
            <a href="#">Back to top</a>
            </aside>
        
        <section>
            
                <div id="toc">
    <h4>Table of Contents</h4>
    <aside>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#che260">CHE260</a>
      <ul>
        <li><a href="#variables">Variables</a></li>
        <li><a href="#heat-transfer-mechanisms">Heat Transfer Mechanisms</a></li>
        <li><a href="#steady-heat-transfer">Steady Heat Transfer</a></li>
        <li><a href="#transient-heat-transfer">Transient Heat Transfer</a></li>
        <li><a href="#forced-convection-heat-transfer">Forced Convection Heat Transfer</a></li>
        <li><a href="#radiation-heat-transfer">Radiation Heat Transfer</a></li>
      </ul>
    </li>
    <li><a href="#ece253-digital-and-computer-systems">ECE253: Digital and Computer Systems</a>
      <ul>
        <li><a href="#logic-and-circuits">Logic and Circuits</a></li>
        <li><a href="#verilog">Verilog</a></li>
        <li><a href="#arm-assembly">ARM Assembly</a></li>
      </ul>
    </li>
    <li><a href="#mat292">MAT292</a></li>
    <li><a href="#aer210">AER210</a></li>
    <li><a href="#phy293">PHY293</a></li>
    <li><a href="#esc203">ESC203</a></li>
  </ul>
</nav>
    </aside>
</div>





            
        <header>
    <h1>Engsci Y2S1 Exam Review</h1>
    





<div class="post-meta">
    Date:
    <time datetime="2021-12-11">Dec 11, 2021</time>,&nbsp;Last Modified:
    <time datetime="2022-01-26">Jan 26, 2022</time>
    <br>
    
    Tags &#x5b;
    <a href="//chenbrian.ca/tags/notes/">notes</a>
    <a href="//chenbrian.ca/tags/engsci/">engsci</a>
    &#x5d;
</div>

</header>
<article>
    <p>Exam &lsquo;cheat sheets&rsquo; for EngSci 2nd year semester fall semester.
These were made as part of my own studying for the exams. As 3/6 of my exams were cancelled due to the omicron covid variant, AER210, MAT292, and PHY293 are missing.</p>
<p>I do not guarantee content correctness &ndash; but if you find a mistake, please let me know!</p>
<h2 id="che260">CHE260</h2>
<p>Note: the following only contains materials for the final exam, so it will <em>only</em> cover the heat-transfer portion of CHE260.</p>
<h3 id="variables">Variables</h3>
<p>Below are some variables and what they generally mean in the context of CHE260</p>
<ul>
<li>\(k\): Thermal conductivity constant. Larger for good heat conductors, lower for ones that do so poorly</li>
<li>\(h\): Convection heat transfer coefficient</li>
<li>\(\alpha = \frac{k}{\rho c_p}\): Thermal diffusivity</li>
<li>\(T_{film} = \frac{T_s + T_\infty}{2}\): Film temperature: estimated temperature at the convection layer</li>
</ul>
<h3 id="heat-transfer-mechanisms">Heat Transfer Mechanisms</h3>
<p>$$Q_{conduction} = -kA\frac{dT}{dx}$$
$$Q_{convection} = hA(T_s - T_\infty)$$
$$Q_{radiation} = \varepsilon\sigma A(T_s^4-T_{surr}^4)$$
Note: for radiation make sure to use Kelvin, not Celsius.</p>
<h3 id="steady-heat-transfer">Steady Heat Transfer</h3>
<p>We can apply the thermal resistance concept to build heat transfer resistance networks:</p>
<p>$$\dot{Q_{tot}} = \frac{T_2 - T_1}{R_{total}}$$</p>
<p>\(R_{total} \) is obtained through the various expressions for heat resistance for different shapes and methods.
Draw out the resistance network and then solve for the total resistance which works in the same way as electrical resistance.
Conduction resistances stacked perpendicular to the direction of heat flow are represented by parallel resistances.</p>
<p>For example, for two planes of glass,</p>
<p>$$R_T = R_{conv, 1} + R_{glass,1} +  \\ R_{air} + R_{glass, 2} + R_{conv, 2}$$</p>
<p>Note the convection on either side.</p>
<p>The temperature at a point is is given using the heat transfer with resistance equation with a known total heat transfer and resistance between points \(a, b \), and temperature at one of the points.</p>
<p>$$Q_{a\rightarrow b} = \frac{T_a - T_b}{R_{a\rightarrow b}}$$</p>
<p>For spherical or cylindrical heat transfer there is a critical radius of insulation \(r_{cr} \) for which the heat transfer rate reaches a maximum, i.e. for \(r &lt; r_{cr} \) the heat transfer rate is below maximum and will actually increase with added insulation until \(r = r_{cr} \), after which the heat transfer rate will go back down again.</p>
<ul>
<li>For a sphere: $$r_{cr} = \frac{2k_{ins}}{h}$$</li>
<li>For a cylinder: $$r_{cr} = \frac{k_{ins}}{h}$$</li>
</ul>
<h4 id="fins">Fins</h4>
<p>For these problems just plug and chug.</p>
<p>$$a = \sqrt{\frac{hP}{kA_c}}$$</p>
<ol>
<li>
<p>Infinitely long fin
$$\frac{T(x) - T_\infty}{T_b - T_\infty} = exp(-ax)$$
$$\dot{Q} = \sqrt{kPkA_c}exp(-ax)$$</p>
</li>
<li>
<p>Adiabatic tip/insulated tip fin</p>
</li>
</ol>
<p>$$\frac{T(x) - T_\infty}{T_b - T_\infty} = \frac{\cosh{a(L-x)}}{\cosh{aL}}$$
$$\dot{Q} = \sqrt{kPkA_c}(T_b - T_\infty)\tanh{aL}$$</p>
<p>where \(P \) is the perimeter of the fin and \(A_c \) is the cross-sectional area. \(h \) is the convection heat transfer coefficient of the surrounding fluid, and \(k \) the thermal conductivity constant for the fin material</p>
<p>Misc:</p>
<ol>
<li>Fins exposed to convection at tips can be modelled as an adiabatic tip fin with a corrected length</li>
</ol>
<p>$$L_c = L + \frac{A_c}{p}$$</p>
<ol start="2">
<li>Fin efficiency is the ratio of actual heat transfer (non-uniform temperature) to maximum heat transfer (uniform temperature)</li>
</ol>
<p>$$\eta = \frac{\dot{Q_{tot}}}{\dot{Q_{tot\space max}}}$$</p>
<ol start="3">
<li>Fin effectiveness is the ratio of heat transfer due to fins to heat transfer if the fins were not present. \(A_b \) denotes the area of the fin bases, not that of the whole surface the fins are attached to.</li>
</ol>
<p>$$\varepsilon = \frac{\dot{Q_{fin}}}{\dot{Q_{no\space fin}}} = \frac{\dot{Q_{fin}}}{hA_b(T_b-T\infty)}$$</p>
<ol start="4">
<li>Fin effectiveness and efficiency are related by</li>
</ol>
<p>$$\varepsilon = \frac{A_{fin}}{A_{base}}\cdot\eta$$</p>
<h3 id="transient-heat-transfer">Transient Heat Transfer</h3>
<p>TLDR; modelling heat transfer as a function of time as well. If possible, apply lumped system assumption which assumes that the whole system has uniform temperature.</p>
<ul>
<li>Characteristic Length: \(L_c = \frac{V}{A_{surface}}\)</li>
<li>Biot number: \(Bi = \frac{hL_c}{k}\)</li>
</ul>
<p>Note: When we look up \(\lambda_1\) and \(A_1\) from tables make sure to use the same formula for Biot&rsquo;s number as used by the reference source. The textbook uses \(Bi = \frac{hr_o}{k}\) for cylinders and spheres.</p>
<p>Lumped system approximation is valid for $$Bi \leq 0.1$$</p>
<p>We then can get the following by solving the heat equation</p>
<p>$$b = \frac{hA_s}{\rho c_p V} = \frac{h}{\rho c_p L_c}, [b] = s^{-1}$$</p>
<p>$$\frac{T(t) - T_\infty}{T_i - T_\infty} = e^{-bt}$$</p>
<p>Most questions will then get you to plug in the boundary conditions \(T_i, T(t), T_\infty\)  and then have you solve for \(t\) or some combination thereof.</p>
<p>Procedure:</p>
<ol>
<li>Determine \(L_c\)</li>
<li>Determine \(Bi\) and check if lumped system is valid</li>
<li>Plug into heat equation and solve for unknown</li>
</ol>
<p>if \(Bi &gt; 0.1\), then you will have to do some more work.</p>
<ol>
<li>Assume \(\tau&gt;0.2\) so one-term approximation is valid</li>
<li>Given \(Bi\), look up in reference table to find \(\lambda_1\) and \(A_1\)</li>
<li>Plug into the right expression for dimensionless temperature \(\theta = e^{-Bi*\tau}\). Below is the one-term expression for a plane wall. They all generally have a similar form.</li>
</ol>
<p>$$\frac{T(x, t) - T_\infty}{T_i - T_\infty} = A_1e^{-\lambda_1^2\tau}\cos{\frac{\lambda_1 x}{L}}$$
and note that in this expression time is w.r.t. dimensionless time \(\tau\) &ndash; so to convert back to dimensioned time we apply
$$\tau = \frac{\alpha t}{L^2}$$
to recover \(t\).</p>
<p>Note that at the center of a plane wall/cylinder/sphere/etc the above expression can be simplified to
$$\frac{T(0, t) - T_\infty}{T_i - T_\infty} = A_1e^{-\lambda_1^2\tau}$$</p>
<p>For some questions (for example a plane wall cooled on both sides) we can express \(T(x,t)\) w.r.t \(T(0, t)\), i.e. \(T(x, t) = T(0, t)\cos{\lambda_1 x/L}\)</p>
<p>For heat transfer we express it as a % of the maximum heat transfer.</p>
<p>Given</p>
<p>$$Q_{max} = mc_p(T_\infty - T_i)$$</p>
<p>which denotes heat transfer as \(t\rightarrow\infty\)</p>
<p>we derive a ratio \(\frac{Q(t)}{Q_{max}}\) for different geometries, which should be given.
\(Q(t)\) is the sum of internal energy changes throughout the entire geometry which can be expressed as a volume integral.</p>
<h4 id="semi-infinite-solids">Semi-Infinite Solids</h4>
<p>Used to model temperature change in part of body due to thermal conditions on a single surface
TLDR; use this for questions where they don&rsquo;t give you dimensions</p>
<p>$$\eta = \frac{x}{\sqrt{4\alpha t}}$$</p>
<p>For constant \(T_s\) we obtain</p>
<p>$$\frac{T(x,t)-T_i}{T_s-T_i} = erfc(\eta)$$</p>
<p>and</p>
<p>$$\dot{q}_s(t) = \frac{k(T_s-T_i)}{\sqrt{\pi\alpha t}}$$</p>
<p>where</p>
<p>$$erfc(\eta) = 1- \frac{2}{\sqrt{\pi}}\int^\eta_0 e^{-u^2}du$$</p>
<p>Generally we will be looking up \(\eta, erfc(\eta)\) in a table.</p>
<h3 id="forced-convection-heat-transfer">Forced Convection Heat Transfer</h3>
<p>TLDR: What if we forced fluids instead of letting the convection happen naturally?</p>
<p>We know that</p>
<p>$$Q_{conv} = hA(T_s - T_\infty)$$</p>
<p>But how do we get \(h\) for forced convection? Either look it up from a table, get it experimentally, or do some math.</p>
<p>$$h=\frac{-k_{fluid}(\frac{\delta T}{\delta y}\vert_{y=0})}{T_s-T_\infty}$$
Note that the temperature distribution for a moving fluid isn&rsquo;t constant.
We can usually use an average one
$$h=\frac{1}{A_s}\int_{A_s}h_{local}dA_s$$</p>
<p>Note: surface integral for the 2D case, and the over length \(L\) for the 1D.</p>
<p>In cases where the laminar flow region cannot be entirely disregarded, we must integrate over the parts separately</p>
<p>$$h = \frac{1}{L}(\int_0^{x_a} h_{x, laminar}dx + \\ \int_{x_a}^L h_{x, turbulent}dx)$$</p>
<p>Recall from AER210 the that fluid exerts a drag force \(\tau\) on the walls</p>
<p>$$\tau = \mu \frac{\delta\mu}{\delta y} \vert_{y=0}$$</p>
<p>Or,</p>
<p>$$\tau = c_f \frac{\rho v_o^2}{2}$$</p>
<p>where \(c_f\) is a friction coefficient which depends on geometry.</p>
<p>Forced convection is described with help from a few numbers</p>
<ol>
<li>Reynold&rsquo;s number \(Re\)</li>
</ol>
<p>$$Re = \frac{\rho V_\infty D}{\mu} = \frac{V_\infty x}{\nu}$$
Note: \(\nu\) is kinematic viscosity \(\nu = \frac{\mu}{\rho}\)</p>
<p>Large \(Re\) tends towards turbulent flow, small tends towards laminar flow. Generally if \(Re&lt;5*10^5\) the flow is laminar and it is turbulent otherwise.</p>
<ol start="2">
<li>Prachett&rsquo;s number \(Pr\)</li>
</ol>
<p>The ratio of molecular diffusivity of momentum over the molecular diffusivity of heat</p>
<p>$$Pr = \frac{v}{\alpha} = \frac{\mu c_p}{k}$$</p>
<ol start="3">
<li>Nusselt&rsquo;s Number \(Nu\)</li>
</ol>
<p>The dimensionless heat transfer coefficient which is the ratio of the <em>convective</em> heat transfer rate to the <em>conductive</em> heat transfer rate.</p>
<p>$$Nu = \frac{hL_c}{k}$$</p>
<p>We can then apply Buckingham \(\pi\) to represent \(Nu\) w.r.t. \(Re\) and \(Pr\).</p>
<p>$$Nu_x = \frac{h_xx}{k} = cRe_x^nPr^m$$</p>
<p>Note that here \(Nu\) is local to point \(x\)</p>
<p>And the coefficients \(c, m, n\) can either be solved for with experimental data or will be given.
For example, for laminar flow over a flat plate:</p>
<p>$$Nu = \frac{hL}{k} = 0.664Re_L^{0.5}Pr^{(1/3)}, \\ Re_L &lt; 5*10^5, Pr &gt; 0.6$$</p>
<p>&hellip; and for turbulent flow:
$$Nu = \frac{hL}{k} = 0.037Re_L^{0.8}Pr^{(1/3)}, \\ 5*10^5 \leq Re_L \leq 10^7, 0.6 \leq Pr \leq 60 $$</p>
<p>For isothermal surfaces with an unheated starting section of length \(\xi\) the local Nusselt&rsquo;s number is given by</p>
<p>laminar :</p>
<p>$$Nu_x = \frac{hL}{k} = \frac{0.332Re_x^{0.5}Pr^{1/3}}{[1-(\xi/x)^{3/4}]^{1/3}}$$</p>
<p>turbulent :</p>
<p>$$Nu_x = \frac{hL}{k} = \frac{0.0296Re_x^{0.8}Pr^{1/3}}{[1-(\xi/x)^{910}]^{1/9}}$$</p>
<p>What is important to note here is that these equations are valid for an isothermal flat plate with an unheated starting section of length \(\xi=0\) as well. The equations would be the same as the two above except the denominator is 1.
The previous equations (e.g. \(c=0.664\)) are valid for a flat plate heated at the leading edge.</p>
<h4 id="other">Other:</h4>
<ul>
<li>No-slip condition applies at walls, so right by the wall heat transfer is conductive. \(\dot{q} = \dot{q_{cond}}\)</li>
</ul>
<h3 id="radiation-heat-transfer">Radiation Heat Transfer</h3>
<p>For this section everything is just plug and chug and being careful with view factors.
Most problems involve an energy balance \(\dot{q_{in}} = \dot{q_{out}} \)</p>
<ol>
<li>
<p>Stefan-Boltzmann Law:
$$E_b(T) = \sigma T^4$$</p>
</li>
<li>
<p>Wein&rsquo;s displacement law: finding the wavelength that gives the maximum power for a specified surface temperature
$$(\lambda T)_{max power} = 2897.8 \mu \cdot K$$</p>
</li>
<li>
<p>Reciprocity rule:</p>
</li>
</ol>
<p>$$A_iF_{i\rightarrow j} = A_jF_{j\rightarrow i}$$</p>
<p>Where \(F_{i\rightarrow j} \) is the &lsquo;view factor&rsquo;, i.e. the percent of radiation leaving surface \(i \) that strikes surface \(j \) directly.</p>
<ul>
<li>\(\alpha = \frac{G_{absorbed}}{G} \): Absorptivity</li>
<li>\(\rho = \frac{G_{reflected}}{G} \): Reflectivity</li>
<li>\(\tau = \frac{G_{transmitted}}{G}\): Transmissivity</li>
</ul>
<p>These variables also have the property</p>
<p>$$\alpha + \rho + \tau = 1$$</p>
<p>Note: for opaque surfaces \(\tau = 0 \)</p>
<ol start="4">
<li>Summation property: the set of view factors that describe radiation beginning at surface \(i \) and ending at all surfaces \(j \) that it touches has a sum of \(1 \).</li>
</ol>
<p>$$\sum^N_{j=1}F_{ij} = 1$$</p>
<ol start="5">
<li>Putting all together
When are looking at black body radiation only:
$$\dot{Q_{1\rightarrow 2}} = A_1 F_{1\rightarrow 2} \sigma (T_1^4 - T_2^4)$$</li>
</ol>
<p>Note:
$$\dot{Q_{1\rightarrow 2}} = A_1\dot{q_{1\rightarrow 2}}$$</p>
<ol start="6">
<li>Heat transfer between surfaces</li>
</ol>
<p>$$\dot{q_{12}} = \frac{\sigma(T_1^4-T_2^4)}{ \frac{1-\varepsilon_1}{A_1\varepsilon_1} + \frac{1}{A_1F_{12}} + \frac{1-\varepsilon_2}{A_2\varepsilon_2}}$$
Where the middle term in the denominator denotes the &ldquo;resistivity&rdquo; due to space and the other terms due to radiation.</p>
<p>So we can build resistance networks by adding up the resistances of each element here as well!</p>
<ol start="7">
<li>Kirchhoff&rsquo;s law: Total emissivity of a surface is equal to the absorptivity for radiation coming from a black body at the same temperature</li>
</ol>
<p>$$\varepsilon_\lambda(T) = \alpha_\lambda(T)$$</p>
<ol start="8">
<li>Radiosity: The radiation emitted + the radiation reflected by surface \(i \)</li>
</ol>
<p>$$J_i = \varepsilon_i E_{bi} + (1-\varepsilon)G_i$$</p>
<p>Note that we know that for an opaque surface (\(\tau=0\)), \(\varepsilon + \rho = 1 \)</p>
<h4 id="other-1">Other</h4>
<ul>
<li>Radiation heat transfer coefficient \(h_{rad} \) provides radiative heat transfer as \(\dot{q} = h_{rad}(T_1-T_2)\)</li>
</ul>
<h2 id="ece253-digital-and-computer-systems">ECE253: Digital and Computer Systems</h2>
<p>Note: <a href="https://gohugo.io/content-management/syntax-highlighting/">Hugo Chroma</a> for <code>armasm</code> seems to be a little different from ARMv7 used. So the following code blocks will be highlighted with <code>nasm</code> syntax. Comments will be denoted with &lsquo;;&rsquo; but should be &lsquo;//&rsquo; in ARMv7.</p>
<h3 id="logic-and-circuits">Logic and Circuits</h3>
<h4 id="karnaugh-maps">Karnaugh Maps</h4>
<ul>
<li>Group w.r.t powers of 2.</li>
<li>For 7-seg-display draw a K-map for each segment</li>
<li>Minterm: Product term that evals to 1</li>
<li>Maxterm: Sum term that evals to 0
Note that for minterms you don&rsquo;t need to NOT it but for maxterms you do.</li>
<li>Canonical POS: Maxterms that cover all 0s</li>
<li>Canonical SOP: Minterms that cover all 1s</li>
<li>Prime implicant: The largest group that can be covered by a single implicant</li>
<li>Essential Prime Implicants: An implicant that covers a term that is not covered by any other implicant</li>
<li>Find set comprised of most essential prime implicants &ndash; lowest cost cover</li>
</ul>
<h4 id="other-2">Other:</h4>
<ul>
<li>Two&rsquo;s complement: Flip bits and add 1. Leading 1 denotes negative number, leading 0 denotes positive number. E.x. 6 = 000100, -6 = 111001 + 1 = 111010.</li>
<li>Finite State Machines
<ul>
<li>Draw out state table: |state|next w=0, w=1|output</li>
<li>Assign encodings to states e.g. A=1, B=2 .. or use one-hot</li>
<li>Reduce with K-maps; take columns on tables for K-map entries</li>
<li>Use a case statement or series of flip-flops to implement the FSM</li>
</ul>
</li>
</ul>
<h4 id="circuits-to-know">Circuits to know</h4>
<p>


 <img loading="lazy" src="./dflipflop.png" alt=""  />


D flip flop



 <img loading="lazy" src="./gateddlatch.png" alt=""  />


Gated latch</p>
<p>Commonly used to storage a single bit of data. Can be chained together to store multiple bits of data, commonly as a shift register.</p>
<h3 id="verilog">Verilog</h3>
<p>


 <img loading="lazy" src="./verilog_operators.png" alt="Verilog Operators"  />

</p>
<p><a href="https://class.ece.uw.edu/cadta/verilog/operators.html">Source: Operators</a></p>
<ul>
<li>Blocking vs Non-blocking</li>
</ul>
<p><code>=</code> is non-blocking, <code>&lt;=</code> is blocking. For non-blocking <code>=</code> we treat the logic as combinatorial, and for blocking <code>&lt;=</code> we treat the logic as sequential. So all the <code>=</code> steps can take one cycle (completed in parallel) while the <code>&lt;=</code> steps can take multiple cycles (completed in sequence). With sequential logic, &ldquo;step through&rdquo; the behaviour of the circuit first and then it should be pretty clear how to build it.</p>
<ul>
<li>Latches: checks the value as long as clock is high</li>
<li>Flip flops: check only on clock edge</li>
<li>Active high: reset when 1</li>
<li>Active low: reset when 0</li>
<li>Synchronous: reset on the next clock edge that the flip flop is supposed to resond to</li>
<li>Asynchronous: reset on the next clock edge at anytime</li>
<li>Cost heuristic: # gates + # inputs where inputs is the # of inputs to gate. i.e. cost of a AND gate is 1 + 2 = 3 since it is 1 gate and 2 inputs</li>
</ul>
<h3 id="arm-assembly">ARM Assembly</h3>
<p>For <a href="https://www.terasic.com.tw/cgi-bin/page/archive.pl?Language=English&amp;No=836">De1-SOC</a></p>
<ul>
<li>Registers are 32 bit/4 bytes</li>
<li>Each instruction is 32 bits/4bytes long</li>
<li>Tricks:</li>
<li>Can extract the lowest bits out of a register by ANDing it with a ones mask</li>
<li>Left shift by n bits is equivalent to multiply by 2^n</li>
<li>Right shift by n bits is equivalent to divide by 2^n</li>
<li>Registers: R0-R12: General Purpose R13: Stack Pointer R14: Link Register R15: Program Counter R16: Status Register</li>
</ul>
<p>Opcode format:</p>
<p>


 <img loading="lazy" src="./opcode_format.png" alt="Source: https://www.allaboutcircuits.com/uploads/articles/Introduction_to_ARM_Assembly3.png"  />

</p>
<p>We can load the top and bottom halves of registers into another like this:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#080;font-style:italic">; load the top half of R1 into R0</span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">; and the bottom half of R3 into R0</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">MOV</span> <span style="color:#b8860b">R0</span>, <span style="color:#b8860b">R1</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">LSL</span> <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">16</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">ORR</span> <span style="color:#b8860b">R0</span>, <span style="color:#b8860b">R3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="instructions">Instructions</h4>
<p>Note that in the following I use <code>O\d</code> to denote an [O]perand which can be a register, a constant, or whatever else also works.</p>
<ul>
<li><code>MOV DEST, SRC</code></li>
<li><code>LDR TARGET, [SOURCE, #offsetpos1], #offsetpos2</code>. If using offsetpos1, SOURCE is pre-indexed, offsetpos2 post-index. When using with memory location or numeric literal, prepend <code>=</code>, i.e. <code>LDR R0, =LIST</code> or <code>LDR R1, =0x0000000b</code></li>
<li><code>LDR{OPT}</code>, <code>STR{OPT}</code>, opt can be B: byte, H: halfword &ndash; if we only want to use part of it.</li>
<li><code>STR DEST, [TARGET]</code></li>
<li><code>CMP O1, O2</code>: Compare <code>O1</code> and <code>O2</code> by computing <code>O2 - O1</code> and then updating NZCV flags in the CPSR</li>
<li><code>ADD O1, O2, O3</code>: Add <code>O2</code> to <code>O3</code> and store the result in <code>O1</code></li>
<li><code>SUB O1, O2, O3</code>: Subtracts <code>O3</code> from <code>O2</code> and store the result in <code>O1</code></li>
<li><code>ASR</code> (Arithmetic Shift Right): Shift to the right, shifted in bits depend on leading sign bit</li>
<li><code>LSL</code> (Logical Shift Left): Shift to the left, shifted in bits are 0</li>
<li><code>LSR</code> (Logical Shift Right): Shift to the right, shifted in bits are 0</li>
<li><code>MUL, O1, O2, O1</code>: Multiply <code>O1</code> by <code>O2</code> and store the result in <code>O1</code></li>
<li><code>ORR, AND</code>: Bitwise OR, AND</li>
</ul>
<p>Note: <code>MOV</code> directly puts it into the destination register, <code>LDR</code> loads the value from the memory location into the destination register, <code>STR</code> stores the value from the source register into the memory location.
When <code>LDR</code> is used with a literal it first loads the literal into memory and then loads the value from the memory location into the destination register.</p>
<ul>
<li>Conditional Execution
Do CMP, then apply <code>INSTR{COND}</code> or do a branch
Conditions: <code>EQ, NE, GT, LT, GE, LE, S</code>, -E denotes &ldquo;or equal to&rdquo;. <code>S</code> for add, subs updates N, Z, C, V flags</li>
</ul>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#00a000">CMP</span> <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">3</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">ADDLT</span> <span style="color:#b8860b">R0</span>, <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">1</span> <span style="color:#080;font-style:italic">; adds 1 to R0 if R0 &lt; 3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="using-pc-lr">Using <code>PC</code>, <code>LR</code></h4>
<p>At instruction <code>i</code>, <code>PC</code> stores the address of the next instruction at <code>i+1</code>. The current instruction can be obtained via a negative offset <code>,#-4</code>
<code>LR</code> by convention stores what we want to return to after a subroutine.</p>
<p>So, assuming that the first instruction of the following code chunk is stored at <code>0x0</code>,</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#00a000">LDR</span> <span style="color:#b8860b">R0</span>, <span style="">=</span><span style="color:#666">0x2000</span> <span style="color:#080;font-style:italic">; 0x00000000, PC: 0x00000004</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">MOV</span> <span style="color:#b8860b">R2</span>, <span style="">#</span><span style="color:#666">4</span>    <span style="color:#080;font-style:italic">; 0x00000004, PC: 0x00000008</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">BL</span> <span style="color:#b8860b">ROUTINE</span> <span style="color:#080;font-style:italic">; 0x00000008, PC: 0x0000000C, LR 0x0000000C</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">MOV</span> <span style="color:#b8860b">R2</span>, <span style="">#</span><span style="color:#666">5</span> <span style="color:#080;font-style:italic">; 0x0000000C, PC: 0x00000010</span>
</span></span><span style="display:flex;"><span><span style="color:#a0a000">ROUTINE:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">PUSH</span> <span style="">{</span><span style="color:#b8860b">LR</span><span style="">}</span> <span style="color:#080;font-style:italic">; 0x00000010, LR=0x0000000C</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="subroutines">Subroutines</h4>
<ul>
<li>Parameters are passed via <code>R0-R3</code>, which subroutines are free to modify and return with</li>
<li>Subroutine should not modify the remaining registers; if so they should <code>PUSH/POP</code> to the stack before and after use</li>
<li>Exit subroutine with <code>MOV PC, LR</code></li>
<li><code>BL</code> is a branch and link instruction, which sets <code>LR</code> to the next instruction and sets <code>PC</code> to the label address</li>
</ul>
<h4 id="stacks">Stacks</h4>
<ul>
<li>
<p>Must first initialize stack pointer, <code>LDR SP, 0x20000</code></p>
</li>
<li>
<p>Pushing to the stack pointer puts the value on top of the stack and decreases the stack pointer</p>
</li>
<li>
<p>For many subroutines needing more than the default registers we want to push and pop the registers before and after we&rsquo;re done.</p>
</li>
<li>
<p><code>PUSH {Rs}</code>: Pushs registers onto stack. Registers must be in ascending order and the largest one gets pushed in first. Has effect of decreasing the stack pointer.</p>
</li>
<li>
<p><code>POP {Rs}</code>: Pops data off the stack. Does not care what register the stack data comes from; i.e. <code>PUSH {R5} POP {R6}</code> would put R6 into R5. Can be used in recursion to put <code>LR</code> into <code>PC</code>. Has effect of increasing the stack pointer.</p>
</li>
</ul>
<p>For example, taking the initial stack pointer value of <code>0x2000</code> we applying <code>PUSH {R0, R3, LR}</code> we get:</p>
<table>
<thead>
<tr>
<th>memory</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x2000</td>
<td>LR</td>
</tr>
<tr>
<td>0x1FFC</td>
<td>R3</td>
</tr>
<tr>
<td>0x1FF8</td>
<td>R0</td>
</tr>
</tbody>
</table>
<h4 id="recursion">Recursion</h4>
<p>The following are assuming SP, etc has been init&rsquo;d</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#a0a000">FINDSUM:</span> <span style="color:#080;font-style:italic">;; calc 1+2+...N</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">PUSH</span> <span style="">{</span><span style="color:#b8860b">R0</span>, <span style="color:#b8860b">LR</span><span style="">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">CMP</span> <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BLT</span> <span style="color:#b8860b">RETURN</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">SUB</span> <span style="color:#b8860b">R0</span>, <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">1</span><span style="color:#080;font-style:italic">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BL</span> <span style="color:#b8860b">FINDSUM</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">ADD</span> <span style="color:#b8860b">R1</span>, <span style="color:#b8860b">R1</span>, <span style="color:#b8860b">R0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a0a000">RETURN:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">POP</span> <span style="">{</span><span style="color:#b8860b">R0</span>, <span style="color:#b8860b">PC</span><span style="">}</span> <span style="color:#080;font-style:italic">;; puts LR into PC</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#a0a000">FIB:</span> <span style="color:#080;font-style:italic">;; returns in R1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">PUSH</span> <span style="">{</span><span style="color:#b8860b">R0</span>, <span style="color:#b8860b">LR</span><span style="">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">MOV</span> <span style="color:#b8860b">R2</span>, <span style="color:#b8860b">R0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">CMP</span> <span style="color:#b8860b">R2</span>, <span style="">#</span><span style="color:#666">2</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BLT</span> <span style="color:#b8860b">RET</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">SUB</span> <span style="color:#b8860b">R0</span>, <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BL</span> <span style="color:#b8860b">FIB</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">ADD</span> <span style="color:#b8860b">R1</span>, <span style="color:#b8860b">R2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">SUB</span> <span style="color:#b8860b">R0</span>, <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BL</span> <span style="color:#b8860b">FIB</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">ADD</span> <span style="color:#b8860b">R1</span>, <span style="color:#b8860b">R2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a0a000">RET:</span> <span style="color:#00a000">POP</span> <span style="">{</span><span style="color:#b8860b">R0</span>, <span style="color:#b8860b">PC</span><span style="">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="interrupts">Interrupts</h4>
<p>ARM changes modes when an exception occurs.</p>
<ol>
<li>Processor reset (SVC)</li>
<li>Unimplemented instruction (Undefined)</li>
<li>Error (abort)</li>
<li>Hardware interrupt (IRQ)</li>
</ol>
<ul>
<li>CPSR is svaed to SPSR of new mode</li>
<li>CPSR is changed to enter new mode</li>
<li>PC is saved into banked LR of new mode</li>
<li>Loads into PC a unique addr from the exception vector table associated with the new mode</li>
</ul>
<p>General Interrupt procedure:</p>
<ol>
<li>Provide exception vector table</li>
<li>Init SP for IRQ and SVC mode</li>
<li>Configure GIC (Code provided)</li>
<li>Enable IRQ generation in I/O devices</li>
<li>Enable CPU interrupts (I=0 in CPSR)</li>
<li>Provide <code>IRQ_HANDLER</code> which queries GIC to determine intterupt source</li>
<li>Provide <code>ISR</code>s</li>
<li>Clear interrupt in GIC</li>
</ol>
<p>Steps 1-5:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span>	<span style="color:#00a000">MOV</span> <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">0b</span><span style="color:#666">11010010</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">MSR</span> <span style="color:#b8860b">CPSR</span>, <span style="color:#b8860b">R0</span> <span style="color:#080;font-style:italic">;; now in irq mode</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">LDR</span> <span style="color:#a2f">SP</span>, <span style="">=</span><span style="color:#666">0x20000</span> <span style="color:#080;font-style:italic">;; irq sp</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">MOV</span> <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">0b</span><span style="color:#666">11010011</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">MSR</span> <span style="color:#b8860b">CPSR</span>, <span style="color:#b8860b">R0</span> <span style="color:#080;font-style:italic">;; svc mode</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">LDR</span> <span style="color:#a2f">SP</span>, <span style="">=</span><span style="color:#666">0x3FFFFFFC</span> <span style="color:#080;font-style:italic">;; another stack ptr</span>
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-style:italic">;; Add subroutines to config devices, e.x. CONFIG_KEYS below</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BL</span>     <span style="color:#b8860b">CONFIG_KEYS</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">BL</span>			<span style="color:#b8860b">CONFIG_GIC</span>	<span style="color:#080;font-style:italic">;; configure the ARM generic interrupt controller</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">BL</span>			<span style="color:#b8860b">CONFIG_TIMER</span>	
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">MOV</span> <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">0b</span><span style="color:#666">01010011</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">MSR</span> <span style="color:#b8860b">CPSR</span>, <span style="color:#b8860b">R0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a0a000">CONFIG_KEYS:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R0</span>, <span style="">=</span><span style="color:#b8860b">KEY_BASE</span><span style="color:#080;font-style:italic">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">MOV</span>		<span style="color:#b8860b">R1</span>, <span style="">#</span><span style="color:#666">0b</span><span style="color:#666">1111</span> <span style="color:#666">//</span> <span style="color:#b8860b">mask</span> <span style="color:#b8860b">enable</span> <span style="color:#b8860b">bits</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">STR</span>		<span style="color:#b8860b">R1</span>, [<span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">8</span>]		<span style="color:#666">//</span> <span style="color:#b8860b">enable</span> <span style="color:#b8860b">interrupts</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">MOV</span> <span style="color:#b8860b">PC</span>, <span style="color:#b8860b">LR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Steps 6, 8:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#a0a000">IRQ_HANDLER:</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">PUSH</span> <span style="">{</span><span style="color:#b8860b">R0</span><span style="color:#666">-</span><span style="color:#b8860b">R5</span>, <span style="color:#b8860b">LR</span><span style="">}</span> <span style="color:#080;font-style:italic">; save registers</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R4</span>, <span style="">=</span><span style="color:#b8860b">MPCORE_GIC</span> <span style="color:#b8860b">CPUIF</span> <span style="color:#080;font-style:italic">;; memory offset to get to GIC</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R5</span>, [<span style="color:#b8860b">R4</span>, <span style="">#</span><span style="color:#b8860b">ICCIAR</span>] <span style="color:#080;font-style:italic">;; read interrupt ID</span>
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-style:italic">;; then, CMP R5 to call appropriate handler</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">e.x.</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">CMP</span> <span style="color:#b8860b">R5</span>, <span style="">#</span><span style="color:#b8860b">TIMER_IRQ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BNE</span> <span style="color:#b8860b">EXIT_IRQ</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BL</span> <span style="color:#b8860b">KEY_ISR</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a0a000">EXIT_IRQ:</span> <span style="color:#080;font-style:italic">;; clean up</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">STR</span> <span style="color:#b8860b">R5</span>, [<span style="color:#b8860b">R4</span>, <span style="">#</span><span style="color:#666">0x10</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">POP</span> <span style="">{</span><span style="color:#b8860b">R0</span><span style="color:#666">-</span><span style="color:#b8860b">R5</span>, <span style="color:#b8860b">LR</span><span style="">}</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">SUBS</span> <span style="color:#b8860b">PC</span>, <span style="color:#b8860b">LR</span>, <span style="">#</span><span style="color:#666">4</span> <span style="color:#080;font-style:italic">;; return to previous instruction</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Step 7:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#a0a000">KEY_ISR:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R0</span>, <span style="">=</span><span style="color:#b8860b">KEY_ADDR</span> <span style="color:#080;font-style:italic">;; base key addr</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R1</span>, [<span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">0xC</span>] <span style="color:#080;font-style:italic">;; edge capture register</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">STR</span> <span style="color:#b8860b">R1</span>, [<span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">0xC</span>] <span style="color:#080;font-style:italic">;; clear interrupt</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R0</span>, <span style="">=</span><span style="color:#b8860b">KEY_PRESSED</span> <span style="color:#080;font-style:italic">;; global variable to return result</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">MOV</span> <span style="color:#b8860b">R3</span>, <span style="">#</span><span style="color:#666">0b</span><span style="color:#666">0001</span> <span style="color:#080;font-style:italic">;; check key0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">ANDS</span> <span style="color:#b8860b">R3</span>, <span style="color:#b8860b">R1</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BEQ</span> <span style="color:#a2f">CH</span><span style="color:#b8860b">ECK_KEY1</span> <span style="color:#080;font-style:italic">;; if AND produces 0, skip to next instruction</span>
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-style:italic">;; and so forth \ldots </span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">MOV</span> <span style="color:#b8860b">PC</span>, <span style="color:#b8860b">LR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#a0a000">TIMER_ISR:</span> <span style="color:#080;font-style:italic">;; ISR to increment ones, tens in memory</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">PUSH</span> <span style="">{</span><span style="color:#b8860b">R6</span><span style="color:#666">-</span><span style="color:#b8860b">R10</span>, <span style="color:#b8860b">LR</span><span style="">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R6</span>, <span style="">=</span><span style="color:#b8860b">COUNT_ONES</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R7</span>, [<span style="color:#b8860b">R6</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R8</span>, <span style="">=</span><span style="color:#b8860b">COUNT_TENS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R3</span>, [<span style="color:#b8860b">R8</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">add</span> <span style="color:#b8860b">r7</span>, <span style="">#</span><span style="color:#666">1</span> <span style="color:#080;font-style:italic">;; increment ones digit value to display</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">cmp</span> <span style="color:#b8860b">r7</span>, <span style="">#</span><span style="color:#666">10</span> <span style="color:#080;font-style:italic">;; if 10, need to update tens digit and roll over to zero</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BNE</span> <span style="color:#b8860b">RET_ISR</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">MOV</span> <span style="color:#b8860b">r7</span>, <span style="">#</span><span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">add</span> <span style="color:#b8860b">r3</span>, <span style="">#</span><span style="color:#666">1</span> <span style="color:#080;font-style:italic">;; increment tens digit</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">cmp</span> <span style="color:#b8860b">r3</span>, <span style="">#</span><span style="color:#666">10</span> <span style="color:#080;font-style:italic">;; if 10 (value is 100), need to roll over to zero</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BNE</span> <span style="color:#b8860b">RET_ISR</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">mov</span> <span style="color:#b8860b">r3</span>, <span style="">#</span><span style="color:#666">0</span>
</span></span><span style="display:flex;"><span><span style="color:#a0a000">RET_ISR:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">STR</span> <span style="color:#b8860b">R3</span>, [<span style="color:#b8860b">R8</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">STR</span> <span style="color:#b8860b">r7</span>, [<span style="color:#b8860b">R6</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">mov</span> <span style="color:#b8860b">r0</span>, <span style="color:#b8860b">r3</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">BL</span> <span style="color:#b8860b">hex_display</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">LSL</span> <span style="color:#b8860b">R3</span>, <span style="color:#b8860b">r1</span>, <span style="">#</span><span style="color:#666">8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">mov</span> <span style="color:#b8860b">r0</span>, <span style="color:#b8860b">r7</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">BL</span> <span style="color:#b8860b">hex_display</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">ORR</span> <span style="color:#b8860b">R3</span>, <span style="color:#b8860b">r3</span>, <span style="color:#b8860b">r1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">LDR</span> <span style="color:#b8860b">R8</span>, <span style="">=</span><span style="color:#666">0xFF200020</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">STR</span> <span style="color:#b8860b">R3</span>, [<span style="color:#b8860b">r8</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">LDR</span> <span style="color:#b8860b">R9</span>, <span style="">=</span><span style="color:#666">0xFFFEC600</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">MOV</span> <span style="color:#b8860b">R10</span>, <span style="">#</span><span style="color:#666">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">STR</span> <span style="color:#b8860b">R10</span>, [<span style="color:#b8860b">R9</span>, <span style="">#</span><span style="color:#666">0xC</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">POP</span> <span style="">{</span><span style="color:#b8860b">R6</span><span style="color:#666">-</span><span style="color:#b8860b">R10</span>, <span style="color:#b8860b">LR</span><span style="">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00a000">MOV</span> <span style="color:#b8860b">PC</span>, <span style="color:#b8860b">LR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Setting up stack pointer</p>
</li>
<li>
<p><code>CPSR</code>: Current Program Status Register</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>31</th>
<th>30</th>
<th>29</th>
<th>28</th>
<th>..</th>
<th>7</th>
<th>6</th>
<th>5</th>
<th>4 .. 0</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>N</td>
<td>Z</td>
<td>C</td>
<td>V</td>
<td>..</td>
<td>[I]nterrupt</td>
<td>F</td>
<td>T</td>
<td>mode</td>
<td></td>
</tr>
</tbody>
</table>
<p>CPSR is saved when an interrupt occurs so that flags and mode it can be restored when the interrupt is handled.</p>
<ul>
<li>N: Negative (2&rsquo;s complement bit of result)</li>
<li>Z: Zero</li>
<li>C: Unsigned overflow (carry)</li>
<li>V: Signed overflow</li>
</ul>
<p>There are a few modes and each one of them have a different stack pointer</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>FIQ: 0b10001
</span></span><span style="display:flex;"><span>IRQ: 0b10010
</span></span><span style="display:flex;"><span>SVC: 0b10011
</span></span><span style="display:flex;"><span>Monitor: 0b10110
</span></span><span style="display:flex;"><span>Abort: 0b10111
</span></span><span style="display:flex;"><span>Undefined: 0b11011
</span></span></code></pre></td></tr></table>
</div>
</div><p>We only care about the IRQ and Supervisor modes. These can be set by loading the appropriate value into the CPSR.</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#00a000">MOV</span> <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">0b</span><span style="color:#666">10010</span> <span style="color:#080;font-style:italic">;; irq mode</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">MSR</span> <span style="color:#b8860b">CPSR</span>, <span style="color:#b8860b">R0</span> <span style="color:#080;font-style:italic">;; change to irq mode</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">LDR</span> <span style="color:#a2f">SP</span> ,<span style="">=</span> <span style="color:#666">0x10000</span> <span style="color:#080;font-style:italic">;; set stack pointer</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">MOV</span> <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">0b</span><span style="color:#666">10011</span> <span style="color:#080;font-style:italic">;; supervisor mode</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">MSR</span> <span style="color:#b8860b">CPSR</span>, <span style="color:#b8860b">R0</span> <span style="color:#080;font-style:italic">;; change to supervisor mode</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">LDR</span> <span style="color:#a2f">SP</span> ,<span style="">=</span> <span style="color:#666">0x20000</span> <span style="color:#080;font-style:italic">;; set stack pointer</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note that the two stack pointers on line 3 and 6 are different.</p>
<p>In order to enable interrupts the <code>I</code> must be set to <code>0</code>. <code>1</code> disables it, which is the default.</p>
<h4 id="io">IO</h4>
<h5 id="timers">Timers</h5>
<p>Counts down to 0 at a known clock rate (that of the board).
Takes a load value which is the starting counter value. Current value at an offset.</p>
<ul>
<li><code>A</code>: Autoreload</li>
<li><code>F</code>: Interrupt status (=1 when counter 0)</li>
<li><code>I</code>: Interrupt enable</li>
<li><code>E</code>: Starts timer</li>
</ul>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#a0a000">CONFIG_TIMER:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R8</span>, <span style="">=</span><span style="color:#b8860b">TIMER_BASE</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R0</span>, <span style="">=</span><span style="color:#666">20000000</span> <span style="color:#080;font-style:italic">;; (1/200MHz*20000000)=0.1s</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">STR</span> <span style="color:#b8860b">R0</span>, [<span style="color:#b8860b">R8</span>] <span style="color:#080;font-style:italic">;; set timer counter</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">MOV</span> <span style="color:#b8860b">R1</span>, <span style="">#</span><span style="color:#666">0b</span><span style="color:#666">011</span> <span style="color:#080;font-style:italic">;; A = E = 1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">STR</span> <span style="color:#b8860b">R1</span>, [<span style="color:#b8860b">R8</span>, <span style="">#</span><span style="color:#666">8</span>] <span style="color:#080;font-style:italic">;; write to control register</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">MOV</span> <span style="color:#b8860b">PC</span>, <span style="color:#b8860b">LR</span>
</span></span><span style="display:flex;"><span><span style="color:#a0a000">DELAY:</span> <span style="color:#080;font-style:italic">;; hangs for known time</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">LDR</span> <span style="color:#b8860b">R0</span>, [<span style="color:#b8860b">R8</span>, <span style="">#</span><span style="color:#666">0xC</span>] <span style="color:#080;font-style:italic">;; R8 contains status reg</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">CMP</span> <span style="color:#b8860b">R0</span>, <span style="">#</span><span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">BEQ</span> <span style="color:#b8860b">DELAY</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00a000">STR</span> <span style="color:#b8860b">R0</span>, [<span style="color:#b8860b">R8</span>, <span style="">#</span><span style="color:#666">0xC</span>] <span style="color:#080;font-style:italic">;; write 1 to status to reset interrupt to 0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="using-keys">Using <code>KEYS</code></h5>
<ul>
<li>Enabling interrupts</li>
</ul>
<p>


 <img loading="lazy" src="./keys_loc.png" alt=""  />


Apply a mask onto the relevant memory location.
E.g. to enables <code>KEY3</code> and <code>KEY0</code>, we would:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#00a000">LDR</span> <span style="color:#b8860b">R1</span>, <span style="">=</span><span style="color:#666">0xFF20058</span> <span style="color:#080;font-style:italic">;; int mask addr</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">MOV</span> <span style="color:#b8860b">R2</span>, <span style="">#</span><span style="color:#666">0b</span><span style="color:#666">1001</span> <span style="color:#080;font-style:italic">;; we want to enable KEY3 and KEY0</span>
</span></span><span style="display:flex;"><span><span style="color:#00a000">STR</span> <span style="color:#b8860b">R2</span>, [<span style="color:#b8860b">R1</span>] <span style="color:#080;font-style:italic">;; write mask onto enable bits</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When polling just grab the items at the base address.
When using interrupts <code>LDR</code> the <code>edge capture</code> register to find the ones that have been pressed</p>
<h5 id="using-ledr">Using LEDR</h5>
<p>To display using LEDR we just need to write the value we want to the appropriate memory location.
Here, assuming that what we want to display is stored in <code>R1</code>:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>LDR R2, =0xFF2000000 ;; LEDR addr
</span></span><span style="display:flex;"><span>STR [R1], R2 ;; write to LEDR
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="mat292">MAT292</h2>
<h2 id="aer210">AER210</h2>
<h2 id="phy293">PHY293</h2>
<h2 id="esc203">ESC203</h2>
<p>n/a</p>

</article>


        </section>
    </div>
<div class="footer">
    
    
    <div class="footer-links">
        <a href="https://github.com/ihasdapie">GitHub</a> &nbsp;
        <a href="https://github.com/ihasdapie/bettermotherfuckinghugowebsite/">Theme</a> &nbsp;
    </div>
    

    
    
    <div class="copyright"> 2022  Brian Chen  All rights reserved.</div>
    
    <div id="wcb" class="carbonbadge"></div>

    <script src="https://unpkg.com/website-carbon-badges@1.1.3/b.min.js" defer></script>
</div>

</body>

</html>
